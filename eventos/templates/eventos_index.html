{% extends 'base.html' %}

{% block content %}
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <div class="container">
        <div class="jumbotron">
            <h1 class="text-center">Eventos CADir UnB</h1>
            <script src="../../static/js/eventos.js"></script>
            <script>
                function get_bd_events() {
                    const eventos = [
                        {% for evento in Eventos %}
                            {
                                id: '{{ evento.id }}',
                                allDay: {{ evento.isAllDay|lower }},
                                description: '{{ evento.desc|truncatewords:20 }}',
                                title: '{{ evento.title }}',
                                start: '{{ evento.start_day|date:'Y-m-d' }}T{{ evento.start|time:"H:i" }}',
                                end: '{{ evento.end_day|date:'Y-m-d' }}T{{ evento.end|time:"H:i" }}',
                                start_time: '{{ evento.start|time:"H:i" }}',
                                end_time: '{{ evento.end|time:"H:i" }}',
                                local: '{{ evento.local }}',
                                backgroundColor: '#001652',
                                borderColor: '#001652',
                                textColor: 'white',
                                url: '{% url 'eventos:show' pk=evento.id %}',
                                hover: true
                                },
                        {% endfor %}
                    ]
                    return eventos;
                }
                const eventos = get_eventos(get_bd_events());
                console.log(eventos)
                $(function () {
                    $('#calendar').fullCalendar({
                        plugins: ['interaction', 'dayGrid', 'timeGrid', 'list'],
                        header: {
                            left: 'prev,next today',
                            center: 'title',
                            // dayGridMonth, timeGridMonth, timeGridDay not workings
                            right: 'dayGridMonth, timeGridMonth, timeGridDay, month , listMonth'
                        },
                        buttonIcons: false,
                        navLinks: true,
                        eventLimit: true,

                        locale: 'pt-br',

                        eventRender: function (eventObj, $el) {
                            // Analisando se o evento Ã© o dia inteiro para modificar layout do hover
                            var conteudo;
                            if (eventObj.allDay) {
                                conteudo = '<div>' + eventObj.description + '</div>' +
                                    '<div><i class="far fa-clock"></i>' + ' ' + "Dia inteiro" + ' ' +
                                    '<i class="fas fa-map-marker-alt"></i>' + ' ' + eventObj.local + '</div>'
                            } else {
                                conteudo = '<div>' + eventObj.description + '</div>' +
                                    '<div><i class="far fa-clock"></i>' + ' ' + eventObj.start_time + ' - ' + eventObj.end_time + ' ' +
                                    '<i class="fas fa-map-marker-alt"></i>' + ' ' + eventObj.local + '</div>'
                            }
                            $el.popover({
                                title: eventObj.title,
                                html: true,
                                content: conteudo,
                                trigger:
                                    'hover',
                                placement:
                                    'top',
                                container:
                                    'body'
                            })
                            ;
                        },
                        events: eventos,
                    });
                });
            </script>
            <br>
            <div id='calendar'></div>
        </div>
    </div>
{% endblock %}